# LAMMPS Crystal Melting Script for Li2B3O4F3
# Takes ordered crystal structure and melts it at high temperature
units metal
atom_style charge
boundary p p p
processors * * *  # Use all available processors

# Read CRYSTAL structure from Materials Project
read_data Li2B3O4F3_crystal.data

# Define potential
# Born-Mayer/Buckingham potential for ionic materials
# Combines electrostatic (Coulomb) with short-range repulsion

# Set oxidation state charges
set type 1 charge 3.0
set type 2 charge -1.0
set type 3 charge -2.0
set type 4 charge 1.0

# Use hybrid: Buckingham (short-range) + Coulomb (long-range)
# Buck: A*exp(-r/rho) - C/r^6
pair_style buck/coul/long 10.0
kspace_style pppm 1.0e-5

# Default Buckingham parameters for ionic solids
# These prevent collapse while allowing Coulomb to dominate
# A=1000 (repulsion strength), rho=0.35 (repulsion range), C=0 (no vdW)
# NOTE: pair_coeff will be set after read_data in the script

# Set pair coefficients
pair_coeff * * 1000.0 0.35 0.0  # Buckingham: A=1000, rho=0.35, C=0

# Neighbor list
neighbor 2.0 bin
neigh_modify every 1 delay 0 check yes

# Initial minimization of crystal
minimize 1.0e-4 1.0e-6 1000 10000

# Initial velocities
velocity all create 300 12345 dist gaussian mom yes rot yes

# STAGE 1: Heat crystal from 300K to 3500K over 100 ps
# Use NPT to allow expansion during melting (critical for actual melting!)
fix 1 all npt temp 300 3500 $(100.0*dt) iso 1.0 1.0 $(1000.0*dt)
timestep 0.001

# Output
thermo 1000
thermo_style custom step time temp press vol etotal ke pe density
dump 1 all custom 5000 Li2B3O4F3_melting_trajectory.dump id type x y z vx vy vz

print "Starting MELTING of Li2B3O4F3: heating crystal from 300K to 3500K"
run 100000

# STAGE 2: Hold at 3500K for 50 ps to ensure fully melted
unfix 1
fix 1 all npt temp 3500 3500 $(100.0*dt) iso 1.0 1.0 $(1000.0*dt)

print "Equilibrating Li2B3O4F3 MELT at 3500K for 50 ps"
run 50000

# Save melted/liquid structure
write_data Li2B3O4F3_melted_liquid.data nocoeff
write_dump all xyz Li2B3O4F3_melted_liquid.xyz modify element B F O Li
undump 1

print "MELTING COMPLETE for {formula} - crystal is now liquid at $(temp)K"
